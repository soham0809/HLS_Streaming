<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>HLS Player with Quality Selection</title>

    <!-- Video.js CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/video.js@7.21.1/dist/video-js.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: #000;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }
      #my-video {
        width: 960px;
        height: 540px;
      }

      /* Ensure quality selector button is visible */
      .vjs-http-source-selector {
        display: block !important;
      }

      /* Style the quality menu */
      .vjs-menu-button-popup .vjs-menu {
        background: rgba(0, 0, 0, 0.9);
        border: 1px solid #444;
      }

      .vjs-menu li {
        color: white;
        padding: 8px 12px;
      }

      .vjs-menu li:hover {
        background: rgba(255, 255, 255, 0.1);
      }
    </style>
  </head>
  <body>
    <video
      id="my-video"
      class="video-js vjs-default-skin"
      controls
      preload="auto"
      playsinline
    ></video>

    <!-- Video.js -->
    <script src="https://cdn.jsdelivr.net/npm/video.js@7.21.1/dist/video.min.js"></script>

    <!-- http-source-selector plugin -->
    <script src="https://cdn.jsdelivr.net/npm/videojs-http-source-selector@1.1.6/dist/videojs-http-source-selector.min.js"></script>

    <script>
      const player = videojs("my-video", {
        html5: {
          vhs: {
            overrideNative: true,
            enableLowInitialPlaylist: true,
            smoothQualityChange: true,
          },
        },
        controls: true,
        autoplay: false,
        preload: "auto",
      });

      player.ready(function () {
        console.log("Player ready");

        // Set the source first
        player.src({
          src: "https://soham-streaming-setup.s3.ap-south-1.amazonaws.com/outputs/master.m3u8",
          type: "application/x-mpegURL",
        });

        // Initialize the plugin after setting source
        player.httpSourceSelector({
          default: "auto",
        });

        // Debug: Log when metadata is loaded
        player.on("loadedmetadata", function () {
          console.log("Metadata loaded");
          console.log("Tech:", player.tech().name);

          // Check if VHS tech is being used
          if (player.tech().vhs) {
            console.log("VHS tech active");
            const representations = player.tech().vhs.representations();
            console.log("Available representations:", representations);
          }
        });

        // Debug: Log any errors
        player.on("error", function () {
          console.error("Player error:", player.error());
        });

        // Debug: Log when plugin is ready
        setTimeout(() => {
          if (player.httpSourceSelector) {
            console.log("HTTP Source Selector plugin is available");
          }
        }, 1000);
      });
    </script>
  </body>
</html>
